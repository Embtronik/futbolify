<div class="polls-container">
  <!-- Header -->
  <div class="page-header">
    <h1>Pollas Futbol√≠sticas</h1>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <span>‚ûï</span> Crear Polla
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="successMessage && !showCreateModal && !showAddMatchModal">
    {{ successMessage }}
  </div>
  <div class="alert alert-error" *ngIf="errorMessage && !showCreateModal && !showAddMatchModal">
    {{ errorMessage }}
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'all'"
      (click)="onTabChange('all')">
      Todas
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'my-polls'"
      (click)="onTabChange('my-polls')">
      Mis Pollas
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'invited'"
      (click)="onTabChange('invited')">
      Participar
    </button>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && polls.length === 0">
    <div class="empty-icon">üé∞</div>
    <ng-container *ngIf="activeTab === 'my-polls'; else noInvitedPolls">
      <h2>No tienes pollas creadas</h2>
      <p>Crea pollas de apuestas e invita a los miembros de tus grupos</p>
      <button class="btn btn-primary" (click)="openCreateModal()">Crear primera polla</button>
    </ng-container>
    <ng-template #noInvitedPolls>
      <h2>No tienes pollas para participar</h2>
      <p>Cuando te inviten a una polla o participes en una, aparecer√° aqu√≠.</p>
    </ng-template>
  </div>

  <!-- Polls Grid -->
  <div class="polls-grid" *ngIf="!loading && polls.length > 0">
    <ng-container *ngFor="let poll of polls">
      <div class="poll-card betting-style" *ngIf="poll as p" (click)="openPollDetail(p)">
        <div class="poll-card-top">
          <div class="poll-card-title">
            <h3>{{ p.nombre }}</h3>
            <span class="badge" [ngClass]="getStatusBadgeClass(p.estado)">
              {{ getStatusText(p.estado) }}
            </span>
          </div>
          <div class="poll-card-desc">{{ p.descripcion || 'Sin descripci√≥n' }}</div>
        </div>
        <div class="poll-card-stats">
          <div class="stat-block">
            <span class="stat-label">Partidos</span>
            <span class="stat-value">{{ p.totalPartidos ?? p.partidos?.length ?? p.partidosCount ?? 0 }}</span>
          </div>
          <div class="stat-block">
            <span class="stat-label">Participantes</span>
            <span class="stat-value">{{ p.totalParticipantes ?? p.participantes?.length ?? p.participantesCount ?? 0 }}</span>
          </div>
        </div>
        <div class="poll-card-footer">
          <div class="actions">
            <button 
              class="btn-icon btn-activate" 
              *ngIf="p.estado === 'CREADA'"
              (click)="activatePoll(p, $event); $event.stopPropagation()"
              title="Activar polla">
              ‚úì
            </button>
            <button 
              class="btn-icon btn-revert" 
              *ngIf="p.estado === 'ABIERTA'"
              (click)="revertPollToCreated(p, $event); $event.stopPropagation()"
              title="Volver a editable">
              ‚¨ÖÔ∏è
            </button>
            <button 
              class="btn-icon btn-delete" 
              *ngIf="(p.creadorEmail || '').toLowerCase().trim() === currentUserEmail"
              (click)="deletePoll(p, $event); $event.stopPropagation()"
              title="Eliminar">
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- Modal Crear Polla -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Crear Nueva Polla</h2>
      <button class="close-btn" (click)="closeCreateModal()">&times;</button>
    </div>

    <form [formGroup]="createPollForm" (ngSubmit)="onSubmitCreatePoll()">
      <div class="modal-body">
        <!-- Informaci√≥n b√°sica -->
        <div class="form-section">
          <h3>Informaci√≥n B√°sica</h3>
          
          <div class="form-group">
            <label>T√≠tulo de la Polla *</label>
            <input 
              type="text" 
              formControlName="nombre" 
              placeholder="Ej: Mundial Qatar 2026">
            <div class="error" *ngIf="createPollForm.get('nombre')?.invalid && createPollForm.get('nombre')?.touched">
              El t√≠tulo es requerido (m√≠nimo 3 caracteres)
            </div>
          </div>

          <div class="form-group">
            <label>Descripci√≥n</label>
            <textarea 
              formControlName="descripcion" 
              rows="3"
              placeholder="Describe las reglas o detalles de la polla"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha de Inicio *</label>
              <input type="datetime-local" formControlName="fechaInicio">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Cuota de Entrada</label>
              <input 
                type="number" 
                formControlName="montoEntrada" 
                placeholder="0">
            </div>
          </div>
        </div>

        <!-- Selecci√≥n de grupos -->
        <div class="form-section">
          <h3>Grupos Invitados *</h3>
          <p class="hint">Selecciona los grupos cuyos miembros podr√°n participar</p>
          
          <div class="teams-grid" *ngIf="myTeams.length > 0">
            <div 
              class="team-card" 
              *ngFor="let team of myTeams"
              [class.selected]="isTeamSelected(team.id)"
              (click)="toggleTeamSelection(team.id)">
              <div class="team-logo" *ngIf="team.logoUrl">
                <img [src]="team.logoUrl" [alt]="team.name">
              </div>
              <div class="team-logo-placeholder" *ngIf="!team.logoUrl">
                {{ team.name.charAt(0) }}
              </div>
              <div class="team-info">
                <h4>{{ team.name }}</h4>
                <p>{{ team.memberCount || 0 }} miembros</p>
              </div>
              <div class="check-icon" *ngIf="isTeamSelected(team.id)">‚úì</div>
            </div>
          </div>

          <div class="empty-teams" *ngIf="myTeams.length === 0">
            <p>No tienes grupos creados. Crea un grupo primero para poder invitar miembros.</p>
          </div>

          <div class="error" *ngIf="createPollForm.get('gruposIds')?.invalid && createPollForm.get('gruposIds')?.touched">
            Debes seleccionar al menos un grupo
          </div>
        </div>

        <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
        <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="closeCreateModal()">
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="createPollForm.invalid || loading">
          {{ loading ? 'Creando...' : 'Crear Polla' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Detalle de Polla -->

<!-- Modal Detalle de Polla: Administraci√≥n (Mis Pollas) -->
<div class="modal-overlay" *ngIf="showPollDetailModal && !isParticiparView" (click)="closePollDetail()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h2>{{ selectedPoll?.nombre }}</h2>
        <span class="badge" [ngClass]="getStatusBadgeClass(selectedPoll?.estado || '')">
          {{ getStatusText(selectedPoll?.estado || '') }}
        </span>
      </div>
      <button class="close-btn" (click)="closePollDetail()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="poll-detail-info">
        <p>{{ selectedPoll?.descripcion }}</p>
        <div class="detail-stats">
          <div class="stat-card">
            <span class="stat-label">Aceptaron</span>
            <span class="stat-value">{{ selectedPoll?.totalParticipantes ?? selectedPoll?.participantes?.length ?? selectedPoll?.participantesCount ?? 0 }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Partidos</span>
            <span class="stat-value">{{ pollMatches.length }}</span>
          </div>
        </div>
      </div>
      <div class="matches-section">
        <div class="section-header">
          <h3>Partidos</h3>
          <button 
            class="btn btn-primary btn-sm" 
            *ngIf="selectedPoll?.estado === 'CREADA'"
            (click)="openAddMatchModal()">
            ‚ûï Agregar Partido
          </button>
        </div>
        <div class="empty-matches" *ngIf="pollMatches.length === 0">
          <p>No hay partidos agregados a√∫n</p>
        </div>
        <div class="matches-list" *ngIf="pollMatches.length > 0">
          <div class="match-item" *ngFor="let match of pollMatches">
            <div class="match-teams">
              <div class="team">
                <img [src]="match.equipoLocalLogo || 'assets/team-placeholder.png'" [alt]="match.equipoLocal">
                <span>{{ match.equipoLocal }}</span>
              </div>
              <div class="vs">VS</div>
              <div class="team">
                <img [src]="match.equipoVisitanteLogo || 'assets/team-placeholder.png'" [alt]="match.equipoVisitante">
                <span>{{ match.equipoVisitante }}</span>
              </div>
            </div>
            <div class="match-info">
              <span class="match-date">{{ formatDateTime(match.fechaHoraPartido) }}</span>
            </div>
            <button 
              class="btn-icon btn-delete" 
              *ngIf="selectedPoll?.estado === 'CREADA'"
              (click)="deleteMatch(match)"
              title="Eliminar partido">
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closePollDetail()">Cerrar</button>
      <button 
        class="btn btn-primary" 
        *ngIf="selectedPoll?.estado === 'CREADA' && pollMatches.length > 0"
        (click)="activatePoll(selectedPoll!, $event)">
        Activar Polla
      </button>
      <button 
        class="btn btn-outline" 
        *ngIf="selectedPoll?.estado === 'ABIERTA'"
         (click)="revertPollToCreated(selectedPoll, $event)">
        Volver a editable
      </button>
    </div>
  </div>
</div>

<!-- Modal Detalle de Polla: Predicci√≥n (Participar) -->
<div class="modal-overlay" *ngIf="showPollDetailModal && isParticiparView" (click)="closePollDetail()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div>
        <h2>{{ selectedPoll?.nombre }}</h2>
        <span class="badge" [ngClass]="getStatusBadgeClass(selectedPoll?.estado || '')">
          {{ getStatusText(selectedPoll?.estado || '') }}
        </span>
      </div>
      <button class="close-btn" (click)="closePollDetail()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="poll-detail-info">
        <p>{{ selectedPoll?.descripcion }}</p>
        <div class="detail-stats">
          <div class="stat-card">
            <span class="stat-label">Aceptaron</span>
            <span class="stat-value">{{ selectedPoll?.totalParticipantes ?? selectedPoll?.participantes?.length ?? selectedPoll?.participantesCount ?? 0 }}</span>
          </div>
          <div class="stat">
            <span class="stat-label">Partidos</span>
            <span class="stat-value">{{ pollMatches.length }}</span>
          </div>
        </div>
      </div>

      <div class="modal-inner-tabs" role="tablist" aria-label="Secciones de participaci√≥n">
        <button
          type="button"
          class="modal-inner-tab"
          [class.active]="participarModalTab === 'participar'"
          (click)="setParticiparModalTab('participar')">
          Participar
        </button>
        <button
          type="button"
          class="modal-inner-tab"
          [class.active]="participarModalTab === 'tabla'"
          (click)="setParticiparModalTab('tabla')">
          Tabla de posiciones
          <span class="mini-badge provisional" *ngIf="standingsDefinitivo === false">Provisional</span>
        </button>
      </div>

      <div class="matches-section">
        <div class="section-header" *ngIf="participarModalTab === 'participar'">
          <h3>Partidos</h3>
        </div>
        <div class="empty-matches" *ngIf="participarModalTab === 'participar' && pollMatches.length === 0">
          <p>No hay partidos agregados a√∫n</p>
        </div>
        <div class="matches-list" *ngIf="participarModalTab === 'participar' && pollMatches.length > 0">
          <form *ngIf="selectedPoll?.estado === 'ABIERTA'" (ngSubmit)="saveAllPredictions()">
            <table class="prediction-table">
              <thead>
                <tr>
                  <th>Local</th>
                  <th></th>
                  <th>Visitante</th>
                  <th>Fecha/Hora</th>
                  <th>Marcador real</th>
                  <th>Goles Local</th>
                  <th>Goles Visitante</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let match of pollMatches">
                  <tr
                    #participarMatchRow
                    [attr.data-match-id]="match.id"
                    [class.locked-row]="isPredictionLocked(match)">
                    <td class="team-cell">
                      <img [src]="match.equipoLocalLogo || 'assets/team-placeholder.png'" [alt]="match.equipoLocal" class="team-logo">
                      <span>{{ match.equipoLocal }}</span>
                    </td>
                    <td class="vs-cell">VS</td>
                    <td class="team-cell">
                      <img [src]="match.equipoVisitanteLogo || 'assets/team-placeholder.png'" [alt]="match.equipoVisitante" class="team-logo">
                      <span>{{ match.equipoVisitante }}</span>
                    </td>
                    <td class="date-cell">{{ formatDateTime(match.fechaHoraPartido) }}</td>
                    <td class="real-score-cell">
                      <div class="real-score">
                        <div class="real-score-main">
                          <ng-container *ngIf="realScoreLoadingByMatchId[match.id]; else realScoreContent">
                            <span class="real-score-loading">Cargando‚Ä¶</span>
                          </ng-container>

                          <ng-template #realScoreContent>
                            <ng-container *ngIf="realScoreByMatchId[match.id] as rs; else realScoreEmpty">
                              <div class="real-score-line">
                                <span class="real-score-value">{{ rs.golesLocal ?? '‚Äî' }} - {{ rs.golesVisitante ?? '‚Äî' }}</span>
                                <span class="real-score-chip" [class.final]="rs.partidoFinalizado">
                                  {{ rs.partidoFinalizado ? 'FT' : (rs.apiStatusShort || '‚Äî') }}
                                </span>
                              </div>
                              <div class="real-score-meta">
                                <span class="real-score-status">{{ rs.apiStatusLong }}</span>
                              </div>
                            </ng-container>
                            <ng-template #realScoreEmpty>
                              <span class="real-score-empty">‚Äî</span>
                            </ng-template>
                          </ng-template>
                        </div>

                        <button
                          type="button"
                          class="btn-icon btn-refresh-score"
                          title="Actualizar marcador real"
                          [disabled]="realScoreLoadingByMatchId[match.id]"
                          (click)="refreshRealScore(match.id)">
                          ‚ü≥
                        </button>
                      </div>
                      <div class="real-score-error" *ngIf="realScoreErrorByMatchId[match.id]">
                        {{ realScoreErrorByMatchId[match.id] }}
                      </div>
                    </td>
                    <td>
                      <input type="number" min="0" [(ngModel)]="match.golesLocalPronosticado" name="golesLocal_{{match.id}}" placeholder="-" required style="width: 50px;" [disabled]="isPredictionLocked(match)">
                    </td>
                    <td>
                      <input type="number" min="0" [(ngModel)]="match.golesVisitantePronosticado" name="golesVisitante_{{match.id}}" placeholder="-" required style="width: 50px;" [disabled]="isPredictionLocked(match)">
                    </td>
                  </tr>
                  <tr *ngIf="getPredictionRowMessage(match) as msg" class="prediction-row-message">
                    <td colspan="7">
                      <div class="error">{{ msg }}</div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
            <div class="prediction-table-footer"></div>
          </form>
        </div>
      </div>

      <div class="standings-section" *ngIf="participarModalTab === 'tabla'">
        <div class="section-header">
          <h3>Tabla de posiciones</h3>
          <div class="standings-actions">
            <span class="mini-badge provisional" *ngIf="standingsDefinitivo === false">Provisional</span>
            <span class="mini-badge final" *ngIf="standingsDefinitivo === true">Definitiva</span>
            <button
              type="button"
              class="btn-icon btn-refresh-score"
              title="Actualizar tabla"
              [disabled]="standingsLoading"
              (click)="refreshStandings()">
              ‚ü≥
            </button>
          </div>
        </div>

        <div class="loading-inline" *ngIf="standingsLoading">Cargando‚Ä¶</div>
        <div class="alert alert-error" *ngIf="standingsError">{{ standingsError }}</div>

        <div class="empty-matches" *ngIf="!standingsLoading && !standingsError && standingsRows.length === 0">
          <p>A√∫n no hay datos para mostrar</p>
        </div>

        <table class="standings-table" *ngIf="!standingsLoading && !standingsError && standingsRows.length > 0">
          <thead>
            <tr>
              <th>#</th>
              <th>Participante</th>
              <th>Puntos</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of standingsRows; index as i">
              <td class="pos-cell">{{ i + 1 }}</td>
              <td class="name-cell" [title]="row.email || ''">{{ row.displayName }}</td>
              <td class="points-cell">{{ row.points }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Success/Error Messages (inside modal so they're visible) -->
      <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
      <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closePollDetail()">Cerrar</button>
      <button 
        class="btn btn-primary"
        *ngIf="participarModalTab === 'participar' && selectedPoll?.estado === 'ABIERTA' && pollMatches.length > 0"
        (click)="saveAllPredictions()"
        [disabled]="savingPredictions || loading">
        {{ savingPredictions ? 'Guardando...' : 'Guardar Pron√≥sticos' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal Agregar Partido -->
<div class="modal-overlay" *ngIf="showAddMatchModal" (click)="closeAddMatchModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Agregar Partido</h2>
      <button class="close-btn" (click)="closeAddMatchModal()">&times;</button>
    </div>

    <form [formGroup]="addMatchForm" (ngSubmit)="onSubmitAddMatch()">
      <div class="modal-body">
        
        <!-- Paso 1: Seleccionar Liga -->
        <div class="form-section" *ngIf="addMatchStep === 'league'">
          <h3>Seleccionar Liga/Competici√≥n</h3>
          <p class="hint">Elige la liga de la cual quieres agregar partidos</p>
          
          <div class="form-group">
            <input 
              type="text" 
              [(ngModel)]="leagueSearchQuery"
              [ngModelOptions]="{standalone: true}"
              (input)="searchLeagues(leagueSearchQuery)"
              placeholder="Buscar liga... (Ej: La Liga, Premier League, Champions)"
              class="search-input">
          </div>

          <!-- Tabla de ligas con scroll -->
          <div class="leagues-table-container">
            <table class="leagues-table" *ngIf="filteredLeagues.length > 0">
              <thead>
                <tr>
                  <th>Logo</th>
                  <th>Liga/Competici√≥n</th>
                  <th>Pa√≠s</th>
                  <th>Temporada</th>
                  <th>Acci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <tr 
                  *ngFor="let league of filteredLeagues"
                  class="league-row"
                  (click)="selectLeague(league)">
                  <td class="league-logo-cell">
                    <img [src]="league.logo" [alt]="league.name" class="league-logo-img">
                  </td>
                  <td class="league-name">{{ league.name }}</td>
                  <td class="league-country">{{ league.country }}</td>
                  <!-- <td class="league-season">{{ league.season }}</td> -->
                  <td class="league-action">
                    <button type="button" class="btn-small btn-primary">
                      Seleccionar
                    </button>
                  </td>
                </tr>
            </table>
          </div>

          <div class="empty-state" *ngIf="leagueSearchQuery && filteredLeagues.length === 0">
            <p>No se encontraron ligas con ese nombre</p>
          </div>
          
          <div class="leagues-count" *ngIf="filteredLeagues.length > 0">
            Mostrando {{ filteredLeagues.length }} liga(s)
          </div>
        </div>

        <!-- Paso 2: Seleccionar Partido -->
        <div class="form-section" *ngIf="addMatchStep === 'fixtures' && selectedLeague">
          <div class="selected-league-header">
            <img [src]="selectedLeague.logo" [alt]="selectedLeague.name" class="selected-league-logo">
            <div>
              <h3>{{ selectedLeague.name }}</h3>
              <p>{{ selectedLeague.country }}</p>
            </div>
            <button type="button" class="btn btn-primary btn-sm" (click)="backToLeagueSelection()">
              ‚Üê Cambiar liga
            </button>
          </div>
          <h4>Pr√≥ximos Partidos</h4>
          <div class="loading" *ngIf="loadingFixtures">
            <p>‚öΩ Cargando partidos...</p>
          </div>
          <div class="fixtures-list upcoming-fixtures" *ngIf="!loadingFixtures && upcomingFixtures.length > 0">
            <div class="fixtures-list-modern">
              <div class="fixture-card" *ngFor="let fixture of upcomingFixtures" (click)="selectFixture(fixture)">
                <div class="fixture-card__row">
                  <div class="fixture-col fixture-col--home">
                    <img class="fixture-logo" [src]="fixture.teams.home.logo" [alt]="fixture.teams.home.name">
                    <span class="fixture-team-name">{{ fixture.teams.home.name }}</span>
                  </div>
                  <div class="fixture-col fixture-col--center">
                    <span class="fixture-date-pill">
                      {{ fixture.fixture.date | date:'dd MMM' }}<br>
                      <span class="fixture-date-time">{{ fixture.fixture.date | date:'HH:mm' }}</span>
                    </span>
                    <span class="fixture-venue-inline" *ngIf="fixture.fixture.venue">üèü {{ fixture.fixture.venue.name }}</span>
                  </div>
                  <div class="fixture-col fixture-col--away">
                    <span class="fixture-team-name fixture-team-name--right">{{ fixture.teams.away.name }}</span>
                    <img class="fixture-logo" [src]="fixture.teams.away.logo" [alt]="fixture.teams.away.name">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="empty-state" *ngIf="!loadingFixtures && upcomingFixtures.length === 0">
            <p>No hay partidos pr√≥ximos para esta liga</p>
          </div>
          <!-- Partidos Seleccionados -->
          <div class="fixtures-list" *ngIf="selectedFixtures.length > 0">
            <h4>Partidos Seleccionados ({{ selectedFixtures.length }})</h4>
            <div class="fixtures-list-modern">
              <div class="fixture-card" *ngFor="let fixture of selectedFixtures" (click)="removeSelectedFixture(fixture)" title="Quitar partido de la selecci√≥n">
                <div class="fixture-card__row">
                  <div class="fixture-col fixture-col--home">
                    <img class="fixture-logo" [src]="fixture.teams.home.logo" [alt]="fixture.teams.home.name">
                    <span class="fixture-team-name">{{ fixture.teams.home.name }}</span>
                  </div>
                  <div class="fixture-col fixture-col--center">
                    <span class="fixture-date-pill">
                      {{ fixture.fixture.date | date:'dd MMM' }}<br>
                      <span class="fixture-date-time">{{ fixture.fixture.date | date:'HH:mm' }}</span>
                    </span>
                    <span class="fixture-venue-inline" *ngIf="fixture.fixture.venue">üèü {{ fixture.fixture.venue.name }}</span>
                  </div>
                  <div class="fixture-col fixture-col--away">
                    <span class="fixture-team-name fixture-team-name--right">{{ fixture.teams.away.name }}</span>
                    <img class="fixture-logo" [src]="fixture.teams.away.logo" [alt]="fixture.teams.away.name">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="!loadingFixtures && upcomingFixtures.length === 0">
            <p>No hay partidos pr√≥ximos para esta liga</p>
            <button type="button" class="btn-secondary" (click)="backToLeagueSelection()">
              Seleccionar otra liga
            </button>
          </div>
        </div>

        <!-- Partido seleccionado (resumen) -->
        <div class="selected-match-summary" *ngIf="addMatchForm.get('homeTeamId')?.value && addMatchForm.get('awayTeamId')?.value">
          <h4>‚úÖ Partido Seleccionado</h4>
          <div class="match-preview">
            <div class="team-preview">
              <img [src]="getSelectedHomeTeam()?.logo">
              <span>{{ getSelectedHomeTeam()?.name }}</span>
            </div>
            <span class="vs">VS</span>
            <div class="team-preview">
              <img [src]="getSelectedAwayTeam()?.logo">
              <span>{{ getSelectedAwayTeam()?.name }}</span>
            </div>
          </div>
          <p>üìÖ {{ addMatchForm.get('matchDate')?.value | date:'dd/MM/yyyy HH:mm' }}</p>
          <p>üèÜ {{ addMatchForm.get('league')?.value }}</p>
        </div>

        <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
        <div class="alert alert-error" *ngIf="errorMessage">{{ errorMessage }}</div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="closeAddMatchModal()">
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="selectedFixtures.length === 0 || loading">
          {{ loading ? 'Agregando...' : 'Agregar Partido' }}
        </button>
      </div>
    </form>
  </div>
</div>
